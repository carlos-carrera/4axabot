import builder from 'botbuilder';
import helper from './card-helper';

/**
 * Renderer for carousel cards.
 */
class CarouselRenderer {

  /**
   * Renderer for carousel cards.
   *
   * @constructor
   * @param bot { Object } Parent bot of the renderer.
   */
  constructor(bot) {
    this.bot = bot;
  }

  /**
   * Main render method of the class. Renders the card into Microsoft Bot
   * Framework objects, and send them to the front.
   *
   * @param session { Object } Chat session.
   * @param card { Object } Card instance.
   * @param cb { Function } Callback function.
   */
  render(session, card, cb) {
    this.bot.domain.renderObj(session, card, function(error, card) {
      if (error) {
        return cb(error);
      }
      var msg = new builder.Message(session)
        .textFormat(builder.TextFormat.xml)
        .attachmentLayout(builder.AttachmentLayout.carousel);
      var arr = [];
      for (var i = 0; i < card.cards.length; i++) {
        arr.push(helper.buildCard(session, card.cards[i]));
      }
      msg.attachments(arr);
      session.send(msg);
      return cb(null, card);
    });
  }
}

export default CarouselRenderer;
